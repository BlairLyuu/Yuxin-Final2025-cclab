<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P5.js Seen Tide till - Time</title>
    
    <!-- [第一步：引入 p5.js 库和 p5.sound] -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/addons/p5.sound.min.js"></script>
    
    <!-- [自定义修改：引入 Google Fonts] -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Commissioner:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* [自定义修改：引入简体字体] */
        @font-face {
            font-family: 'SourceHanSansCN';
            src: url('font/Source Han Sans CN ExtraLight.ttf') format('truetype');
            font-weight: 200;
            font-style: normal;
        }
        
        /* [全局设置 - 保持不变] */
        :root {
            --bg-color: #fcfcfc;
            --text-main: #1a1a1a;
            --text-sub: #8c8c8c;
            --main-font: 'Helvetica Neue', Arial, sans-serif;
            --spacing-section: 160px;
            --glass-bg: rgba(20, 20, 20, 0.85); 
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            /* [自定义修改：背景颜色] 如果没有背景图，显示此颜色 */
            background-color: var(--bg-color); 

            /* =================================================================
               [自定义修改：全局背景图片]
               想要把整个网页背景换成图片？
               请取消下面 5 行代码的注释 (删除每行开头的斜杠和星号)，并替换 url
               ================================================================= */
            
            /* 1. 图片链接 (本地路径 'assets/bg.jpg' 或 网络链接) */
            /* background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop'); */
            
            /* 2. 让图片铺满整个屏幕 */
            /* background-size: cover; */
            
            /* 3. 图片居中显示 */
            /* background-position: center; */
            
            /* 4. 防止图片重复平铺 */
            /* background-repeat: no-repeat; */
            
            /* 5. [可选] 背景固定不动，只有内容滚动 (视差感) */
            /* background-attachment: fixed; */


            font-family: var(--main-font); 
            color: var(--text-main); 
            scroll-behavior: smooth; 
        }
        
        a { text-decoration: none; color: inherit; transition: opacity 0.3s; }
        a:hover { opacity: 0.7; }

        /* [Header 样式 - 保持不变] */
        header { position: fixed; top: 0; left: 0; width: 100%; padding: 20px 5vw; display: flex; justify-content: space-between; align-items: center; z-index: 1000; mix-blend-mode: difference; color: white; opacity: 0.9; }
        .logo { 
            font-weight: 200; 
            font-size: 24px; 
            letter-spacing: 1px; 
            background: transparent; 
            display: block; 
            /* [自定义修改：Logo 字体 - 使用简体字体] */
            font-family: 'SourceHanSansCN', 'Commissioner', sans-serif;
        }
        .nav { display: flex; gap: 30px; align-items: center; transform: scale(0.9); transform-origin: right center; }
        .nav-item-wrapper { position: relative; height: 40px; display: flex; align-items: center; }
        .nav-link { font-size: 14px; font-weight: 500; letter-spacing: 0.5px; color: rgba(255,255,255,0.8); transition: opacity 0.3s ease; position: relative; padding: 0; background: transparent !important; border: none !important; }
        .nav-link:hover, .nav-link.active { color: #fff; opacity: 1; }
        .nav-link::after { content: ''; position: absolute; bottom: -4px; left: 0; width: 0%; height: 1px; background: #fff; transition: width 0.3s ease; }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }
        .dropdown { position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(10px); padding-top: 8px; opacity: 0; visibility: hidden; transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .nav-item-wrapper:hover .dropdown { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .dropdown-menu { background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); padding: 0; min-width: 70px; border: 1px solid var(--glass-border); border-radius: 0; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5); mix-blend-mode: normal; }
        .dropdown-item { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.6); padding: 10px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); transition: all 0.2s; border-radius: 0; }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { color: #fff; background: rgba(255,255,255,0.1); padding-left: 24px; }

        /* [页面特定] */
        .project-hero { padding: 180px 5vw 80px 5vw; max-width: 100vw; }
        .project-header-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 20px; margin-bottom: 80px; align-items: flex-end; }
        .project-title { grid-column: 1 / span 8; font-size: 64px; font-weight: normal; letter-spacing: -1.5px; line-height: 1.1; }
        .project-meta { grid-column: 9 / span 4; display: flex; flex-direction: column; gap: 12px; font-size: 13px; color: var(--text-sub); border-top: 1px solid #e6e6e6; padding-top: 16px; }
        .meta-row { display: flex; justify-content: space-between; }
        
        /* [关键修改] P5 容器样式 */
        .hero-image-wrapper { 
            width: 100%; 
            height: 80vh; 
            overflow: hidden; 
            position: relative; 
            background-color: #000; /* 黑色背景，与 p5.js 背景一致 */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .hero-image-wrapper canvas {
            display: block;
            /* 保持原始比例，不拉伸 */
            max-width: 100%;
            height: auto;
        }

        .content-container { padding: 0 5vw; margin-bottom: var(--spacing-section); }
        .intro-text-section { display: grid; grid-template-columns: repeat(12, 1fr); margin-top: 120px; margin-bottom: 160px; }
        .intro-body { grid-column: 5 / span 6; font-size: 18px; line-height: 1.8; color: #333; }
        .visual-gallery { display: flex; flex-direction: column; gap: 120px; }
        .layout-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }

        /* Tide 图像容器 - 竖版 3:4 比例 */
        .work-img-wrapper { 
            width: 60%;              /* 缩小到原来的 0.6 */
            margin: 0 auto;          /* 水平居中 */
            background-color: #222; 
            aspect-ratio: 3 / 4; /* 宽:高 = 3:4 竖版 */
            overflow: hidden;
        }
        .work-img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            object-position: center; 
            transition: 0.8s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .caption { margin-top: 16px; font-size: 12px; color: var(--text-sub); letter-spacing: 0.5px; }
        .next-project-section { border-top: 1px solid #e6e6e6; padding: 100px 5vw; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background-color 0.4s; }
        .next-project-section:hover { background-color: #f9f9f9; }
        .next-label { font-size: 12px; color: var(--text-sub); text-transform: uppercase; margin-bottom: 10px; }
        .next-title { font-size: 32px; font-weight: bold; }
        .arrow-icon { font-size: 32px; transition: transform 0.3s; }
        .next-project-section:hover .arrow-icon { transform: translateX(10px); }
        .fade-up { opacity: 0; transform: translateY(40px); transition: all 0.8s ease; }
        .is-visible { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>
    <header>
        <a href="index.html" class="logo">屿&nbsp;&nbsp;&nbsp;&nbsp;Lyuuxina</a>
        <nav class="nav">
            <div class="nav-item-wrapper"><a href="index.html" class="nav-link">Home</a></div>
            <div class="nav-item-wrapper">
                <a href="index.html" class="nav-link active">Work</a>
                <div class="dropdown">
                    <div class="dropdown-menu">
                        <a href="WDindex.html" class="dropdown-item">Design</a>
                        <a href="WISindex.html" class="dropdown-item">Installation</a>
                        <a href="Windex.html" class="dropdown-item">Digital Art</a>
                        <a href="illustration.html" class="dropdown-item">Illustration</a>
                    </div>
                </div>
            </div>
            <div class="nav-item-wrapper">
                <a href="Aindex.html" class="nav-link">About</a>
                <div class="dropdown">
                    <div class="dropdown-menu">
                        <a href="Aindex.html#bio" class="dropdown-item">Biography</a>
                        <a href="Aindex.html#education" class="dropdown-item">Education</a>
                        <a href="Aindex.html#experience" class="dropdown-item">Experience</a>
                        <a href="Aindex.html#award" class="dropdown-item">Award</a>
                    </div>
                </div>
            </div>
            <!-- 从 Digital Art 页面跳转到 Contact（Cindex.html） -->
            <div class="nav-item-wrapper"><a href="Cindex.html" class="nav-link">Contact</a></div>
        </nav>
    </header>

    <main>
        <section class="project-hero">
            <div class="project-header-grid fade-up">
                <h1 class="project-title">Design Your<br>Character</h1>
                <div class="project-meta">
                    <div class="meta-row"><span>Year</span><span>2025</span></div>
                    <div class="meta-row"><span>Category</span><span>Digital Art/ Code</span></div>
                    <div class="meta-row"><span>Library</span><span>ccLab. Assignment 07</span></div>
                </div>
            </div>
            
            <!-- [第二步：创建容器 - p5.js 项目] -->
            <div id="p5-character-container" class="hero-image-wrapper fade-up"></div>
        </section>

        <section class="content-container">
            <div class="intro-text-section fade-up">
                <div class="intro-body">
                    <p>Above is a live p5.js sketch embedded directly into the hero section. Move your mouse to interact.</p>
                </div>
            </div>
            
            <!-- [可选：在网格中插入另一个小游戏] -->
            <div class="visual-gallery">
                <div class="layout-grid-2 fade-up">
                    <div>
                        <div class="work-img-wrapper">
                            <img src="image/p501.png" alt="Figure 01" class="work-img">
                        </div>
                        <div class="caption">Figure 01.</div>
                    </div>
                    <div>
                        <div class="work-img-wrapper">
                            <img src="image/p502.png" alt="Figure 02" class="work-img">
                        </div>
                        <div class="caption">Figure 02.</div>
                    </div>
                </div>
            </div>
        </section>

        <a href="installation.html" class="next-project-section">
            <div>
                <div class="next-label">Next Project</div>
                <div class="next-title">Geometric Space</div>
            </div>
            <div class="arrow-icon">→</div>
        </a>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(e => { if(e.isIntersecting) e.target.classList.add('is-visible') });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-up').forEach(el => observer.observe(el));
        });

        // [p5.js 实例模式 - 整合 p5jsMid 项目]
        const characterSketch = (p) => {
            let character = {
                hair: [],
                face: [],
                clothes: [],
                skin: []
            };

            let icons = {
                hair: [],
                face: [],
                clothes: [],
                skin: []
            };

            let categoryButtons = {
                skin: null,
                hair: null,
                face: null,
                clothes: null
            };

            let backgrounds = [];
            let uiLayer;
            let ulbianLayer;

            let bgMusic;
            let musicStarted = false;

            let current = {
                hair: 0,
                face: 0,
                clothes: 0,
                skin: 0,
                background: 0
            };

            let currentCategory = 0;
            let categories = ['skin', 'hair', 'face', 'clothes'];

            // 缩放
            let scaleFactor = 0.3;
            let fullWidth = 1668;
            let fullHeight = 2224;

            p.preload = () => {
                uiLayer = p.loadImage('p5jsMid/ui.png');
                ulbianLayer = p.loadImage('p5jsMid/Ulbian.png');
                
                // 加载背景音乐
                bgMusic = p.loadSound('p5jsMid/music1.mp3');
                
                //category buttons
                categoryButtons.skin = p.loadImage('p5jsMid/SKIN.png');
                categoryButtons.hair = p.loadImage('p5jsMid/HAIR.png');
                categoryButtons.face = p.loadImage('p5jsMid/FACE.png');
                categoryButtons.clothes = p.loadImage('p5jsMid/CLOTHES.png');
                
                //character parts
                character.hair[0] = p.loadImage('p5jsMid/HB0.png');
                character.hair[1] = p.loadImage('p5jsMid/HW0.png');
                character.hair[2] = p.loadImage('p5jsMid/HL0.png');
                character.hair[3] = p.loadImage('p5jsMid/HD0.png');
                
                character.face[0] = p.loadImage('p5jsMid/FR0.png');
                character.face[1] = p.loadImage('p5jsMid/FU0.png');
                character.face[2] = p.loadImage('p5jsMid/FA0.png');
                character.face[3] = p.loadImage('p5jsMid/FB0.png');
                
                character.clothes[0] = p.loadImage('p5jsMid/clP0.png');
                character.clothes[1] = p.loadImage('p5jsMid/clB0.png');
                character.clothes[2] = p.loadImage('p5jsMid/clW0.png');
                character.clothes[3] = p.loadImage('p5jsMid/clR0.png');
                
                character.skin[0] = p.loadImage('p5jsMid/skinG.png');
                character.skin[1] = p.loadImage('p5jsMid/skinB.png');
                character.skin[2] = p.loadImage('p5jsMid/skinP.png');
                character.skin[3] = p.loadImage('p5jsMid/skinD.png');
                
                // Load icons
                icons.hair[0] = p.loadImage('p5jsMid/HB.png');
                icons.hair[1] = p.loadImage('p5jsMid/HW.png');
                icons.hair[2] = p.loadImage('p5jsMid/HL.png');
                icons.hair[3] = p.loadImage('p5jsMid/HD.png');
                
                icons.face[0] = p.loadImage('p5jsMid/FR.png');
                icons.face[1] = p.loadImage('p5jsMid/FU.png');
                icons.face[2] = p.loadImage('p5jsMid/FA.png');
                icons.face[3] = p.loadImage('p5jsMid/FB.png');
                
                icons.clothes[0] = p.loadImage('p5jsMid/clP.png');
                icons.clothes[1] = p.loadImage('p5jsMid/clB.png');
                icons.clothes[2] = p.loadImage('p5jsMid/clW.png');
                icons.clothes[3] = p.loadImage('p5jsMid/clR.png');
                
                icons.skin[0] = p.loadImage('p5jsMid/sG.png');
                icons.skin[1] = p.loadImage('p5jsMid/sB.png');
                icons.skin[2] = p.loadImage('p5jsMid/sP.png');
                icons.skin[3] = p.loadImage('p5jsMid/sD.png');
                
                // Load backgrounds
                backgrounds[0] = p.loadImage('p5jsMid/1.png');
                backgrounds[1] = p.loadImage('p5jsMid/2.png');
                backgrounds[2] = p.loadImage('p5jsMid/3.png');
                backgrounds[3] = p.loadImage('p5jsMid/4.png');
            };

            p.setup = () => {
                const container = document.getElementById('p5-character-container');
                
                // 保持原始比例：1668:2224，scaleFactor 0.3
                const canvasW = fullWidth * scaleFactor;
                const canvasH = fullHeight * scaleFactor;
                const canvas = p.createCanvas(canvasW, canvasH);
                canvas.parent('p5-character-container');
                
                p.imageMode(p.CORNER);
                randomizeOutfit();
                
                // 音乐音量和循环
                if (bgMusic) {
                    bgMusic.setVolume(0.3);
                    bgMusic.loop();
                }
            };

            p.draw = () => {
                p.background(255);  

                if (backgrounds[current.background]) {
                    p.image(backgrounds[current.background], 0, 0, p.width, p.height);
                }

                if (character.skin[current.skin]) {
                    p.image(character.skin[current.skin], 0, 0, p.width, p.height);
                }

                if (character.clothes[current.clothes]) {
                    p.image(character.clothes[current.clothes], 0, 0, p.width, p.height);
                }

                if (character.face[current.face]) {
                    p.image(character.face[current.face], 0, 0, p.width, p.height);
                }

                if (character.hair[current.hair]) {
                    p.image(character.hair[current.hair], 0, 0, p.width, p.height);
                }
                
                if (uiLayer) {
                    p.image(uiLayer, 0, 0, p.width, p.height);
                }
                
                if (ulbianLayer) {
                    p.image(ulbianLayer, 0, 0, p.width, p.height);
                }
                
                drawIconGallery();
                drawCategoryButtons();
                drawHints();
            };

            function drawCategoryButtons() {
                // 原始位置缩小
                let buttonY = 1480 * scaleFactor;
                let buttonWidth = 300 * scaleFactor;
                let buttonHeight = 90 * scaleFactor;
                let spacing = 42 * scaleFactor;
                let totalWidth = buttonWidth * 4 + spacing * 3;
                let startX = (p.width - totalWidth) / 2;
                
                for (let i = 0; i < categories.length; i++) {
                    let x = startX + i * (buttonWidth + spacing);
                    let categoryName = categories[i];
                    
                    // Selection highlight
                    if (i === currentCategory) {
                        p.fill(180, 210, 240, 120);
                        p.noStroke();
                        p.rect(x + 5, buttonY, buttonWidth - 10, buttonHeight, 10);
                    }
                    
                    // Button image
                    if (categoryButtons[categoryName]) {
                        p.image(categoryButtons[categoryName], x + 10, buttonY + 5, buttonWidth - 20, buttonHeight - 10);
                    }
                }
            }

            function drawIconGallery() {
                let galleryY = 1700 * scaleFactor;
                let iconSize = 350 * scaleFactor;
                let spacing = 42 * scaleFactor;
                let totalWidth = iconSize * 4 + spacing * 3;
                let startX = (p.width - totalWidth) / 2;
                
                let categoryName = categories[currentCategory];
                let currentIcons = icons[categoryName];
                
                for (let i = 0; i < 4; i++) {
                    let x = startX + i * (iconSize + spacing);
                    
                    // Selection highlight
                    if (current[categoryName] === i) {
                        p.fill(180, 210, 240, 150);
                        p.stroke(100, 150, 200);
                        p.strokeWeight(1.5);
                        p.rect(x - 10, galleryY - 10, iconSize + 20, iconSize + 20, 15);
                    }
                    
                    // Icon image
                    p.noStroke();
                    if (currentIcons[i]) {
                        p.image(currentIcons[i], x, galleryY, iconSize, iconSize);
                    }
                }
            }

            function drawHints() {
                p.fill(38, 62, 150);
                p.textSize(14);
                p.textAlign(p.CENTER);
                p.noStroke();
                p.text('Press B to change background | Press R to randomize | Press F to save', p.width/2, 20);
            }

            p.mousePressed = () => {
                //category button clicks
                let buttonY = 1480 * scaleFactor;
                let buttonWidth = 300 * scaleFactor;
                let buttonHeight = 90 * scaleFactor;
                let spacing = 42 * scaleFactor;
                let totalWidth = buttonWidth * 4 + spacing * 3;
                let startX = (p.width - totalWidth) / 2;
                
                for (let i = 0; i < categories.length; i++) {
                    let x = startX + i * (buttonWidth + spacing);
                    
                    if (p.mouseX > x && p.mouseX < x + buttonWidth &&
                        p.mouseY > buttonY && p.mouseY < buttonY + buttonHeight) {
                        currentCategory = i;
                        console.log('Switched to category: ' + categories[i]);
                        return;
                    }
                }
                
                //icon clicks
                checkIconClick();
            };

            function checkIconClick() {
                let galleryY = 1700 * scaleFactor;
                let iconSize = 350 * scaleFactor;
                let spacing = 42 * scaleFactor;
                let totalWidth = iconSize * 4 + spacing * 3;
                let startX = (p.width - totalWidth) / 2;
                
                let categoryName = categories[currentCategory];
                
                for (let i = 0; i < 4; i++) {
                    let x = startX + i * (iconSize + spacing);
                    
                    if (p.mouseX > x && p.mouseX < x + iconSize &&
                        p.mouseY > galleryY && p.mouseY < galleryY + iconSize) {
                        current[categoryName] = i;
                        console.log('Switched ' + categoryName + ' to ' + i);
                    }
                }
            }

            p.keyPressed = () => {
                // F save
                if (p.key === 'f' || p.key === 'F') {
                    saveCharacter();
                }
                
                // B key: cycle background
                if (p.key === 'b' || p.key === 'B') {
                    current.background = (current.background + 1) % 4;
                    console.log('Background: ' + current.background);
                }
                
                // R randomize
                if (p.key === 'r' || p.key === 'R') {
                    randomizeOutfit();
                }
            };

            function saveCharacter() {
                let cropX = -48;
                let cropY = -7;
                let cropW = 1764;
                let cropH = 1474;
                
                let canvasW = fullWidth;
                let canvasH = fullHeight;
                
                let actualX = p.max(0, cropX);
                let actualY = p.max(0, cropY);
                let actualW = p.min(canvasW - actualX, cropX + cropW - actualX);
                let actualH = p.min(canvasH - actualY, cropY + cropH - actualY);
                
                let fullCanvas = p.createGraphics(canvasW, canvasH);
                
                //all layers
                if (backgrounds[current.background]) {
                    fullCanvas.image(backgrounds[current.background], 0, 0);
                }
                
                if (character.skin[current.skin]) {
                    fullCanvas.image(character.skin[current.skin], 0, 0);
                }
                
                if (character.clothes[current.clothes]) {
                    fullCanvas.image(character.clothes[current.clothes], 0, 0);
                }
                
                if (character.face[current.face]) {
                    fullCanvas.image(character.face[current.face], 0, 0);
                }
                
                if (character.hair[current.hair]) {
                    fullCanvas.image(character.hair[current.hair], 0, 0);
                }
                
                if (ulbianLayer) {
                    fullCanvas.image(ulbianLayer, 0, 0);
                }
                
                // Crop
                let cropped = fullCanvas.get(actualX, actualY, actualW, actualH);
                
                let timestamp = p.year() + '-' + p.month() + '-' + p.day() + '_' + 
                                p.hour() + '-' + p.minute() + '-' + p.second();
                p.save(cropped, 'character_' + timestamp + '.png');
                
                console.log('Character saved!');
            }

            function randomizeOutfit() {
                current.hair = p.floor(p.random(4));
                current.face = p.floor(p.random(4));
                current.clothes = p.floor(p.random(4));
                current.skin = p.floor(p.random(4));
                current.background = p.floor(p.random(4));
                
                console.log('Randomized!');
            }

            p.windowResized = () => {
                // 保持原始固定尺寸，不随窗口调整
                const canvasW = fullWidth * scaleFactor;
                const canvasH = fullHeight * scaleFactor;
                p.resizeCanvas(canvasW, canvasH);
            };
        };

        new p5(characterSketch);

    </script>
</body>
</html>